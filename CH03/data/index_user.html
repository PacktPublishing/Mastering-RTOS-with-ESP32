<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>GreyterHome</title>
	<style>
		body {
			margin: 0;
		}

		span {
			display: inline-block;
			width: 80px;
		}

		.label {
			color: white;
			padding: 3px 6px;
			border-radius: 3px;
			margin-left: 10px;
		}

		.success {
			background-color: #04AA6D;
		}

		.info {
			background-color: #2196F3;
		}

		.warning {
			background-color: #ff9800;
		}

		.danger {
			background-color: #cf211598;
		}

		.other {
			background-color: #e7e7e7;
			color: black;
		}

		.active-link,
		button:hover,
		a:hover {
			background-color: rgb(99, 94, 155);
		}

		select,
		input {
			margin-left: 10px;
			padding: 3px 5px;
			border: 0;
			border-radius: 6px;
			box-shadow: 0 0 5px 2px rgba(0, 0, 0, 0.06);
		}

		link {
			padding: 3px 5px;
			font-size: larger;
			border-radius: 5px;
		}

		button:disabled {
			color: black;
			background-color: rgb(191, 193, 194);
		}

		button {
			color: #fff;
			text-align: center;
			text-decoration: none;
			padding: 3px 5px;
			font-size: medium;
			border-radius: 5px;
			background-color: rgb(43, 53, 60);
		}

		.item {
			padding: 12px 15px;
		}

		.container {
			display: none;
			flex-wrap: wrap;
			justify-content: space-between;
			width: 100%;
		}

		.active {
			display: flex;
		}

		.heading {
			text-transform: uppercase;
			text-align: start;
			color: white;
			padding: 6px 10px;
			background-color: rgba(56, 62, 66, 0.808);
		}

		.table-cell {
			width: fit-content;
			padding: 6px 10px;
			background-color: rgb(191, 193, 194);
		}

		.table-cell-select {
			width: fit-content;
			padding: 6px 10px;
			background-color: rgb(129, 131, 133);
		}

		.table-cell-select:hover,
		.table-cell-select:focus {
			background-color: rgb(99, 94, 155);
		}

		.table-container {
			width: 90%;
			margin-top: 15px;
			margin-left: auto;
			margin-right: auto;
			border-collapse: collapse;
			font-size: medium;
		}

		.table-container-scan {
			width: 50%;
			margin-top: 15px;
			margin-left: auto;
			margin-right: auto;
			border-collapse: collapse;
			font-size: medium;
		}

		tr.border-bottom td {
			border-bottom: 2pt solid rgb(99, 94, 155);
		}

		tr.border-bottom-light td {
			border-bottom: 1pt solid rgb(211, 209, 233);
		}

		.navbar {
			background-color: rgb(43, 53, 60);
			color: white;
			width: 100%;
			align-items: center;
			display: flex;
		}

		.logo {
			padding-left: 20px;
			text-align: start;
			flex: 1;
			font-size: 28px;
		}

		.menu {
			padding-right: 8px;
			padding-top: 12px;
			padding-bottom: 10px;
			text-align: end;
			font-size: 16px;
		}

		/* media query for small screens */
		@media only screen and (max-width: 700px) {
			.navbar {
				width: 100%;
				flex-direction: column;
				justify-content: center;
			}

			.logo {
				padding-left: 0px;
				text-align: center;
				flex: 1;
				font-size: 24px;
			}

			.menu {
				padding: 6px;
				padding-bottom: 10px;
				text-align: center;
				font-size: 14px;
			}

			.table-container {
				width: 100%;
				margin-top: 5px;
				border-collapse: collapse;
				font-size: small;
			}

			.table-container-scan {
				width: 50%;
				margin-top: 5px;
				border-collapse: collapse;
				font-size: small;
			}
		}
	</style>
</head>

<body onload="get_data()">
	<!-- Navbar  -->
	<div class="navbar">
		<div class="logo">
			Greyter Water System
		</div>
		<div class="menu">
			<a style="padding: 3px 5px; font-size:larger; border-radius: 5px;" class="active-link"
				onclick="showContainer(1)">Home</a>
			<a style="padding: 3px 5px; font-size:larger; border-radius: 5px;" onclick="showContainer(2)">Profile</a>
			<a style="padding: 3px 5px; font-size:larger; border-radius: 5px;" onclick="showContainer(3)">WiFi</a>
		</div>
	</div>
	<!-- Home  -->
	<div id="container1" class="container active" style="flex-direction: column;">
		<table id="tableHomeUser" class="table-container">
			<tr>
				<th>Home: Fetching information, click again if stale</th>
			</tr>
		</table>
		<div class="table-container">
			<button id="editTableButton"
				style="padding: 3px 5px; font-size:medium; border-radius: 5px; color: white; text-decoration: none;"
				onclick="editTimeHandle()">Edit Time</button>
		</div>
		<table id="userEditTimeTable" class="table-container" style="display: none;">
			<tr class="border-bottom-light">
				<td width="36%" class="heading">Time</td>
				<td width="7px" class="heading">:</td>
				<td class="table-cell">
					<select id="time-hours"></select>
					<select id="time-minutes"></select>
					<select id="time-apm"></select>
				</td>
			</tr>
			<tr class="border-bottom-light">
				<td width="36%" class="heading">Date</td>
				<td width="7px" class="heading">:</td>
				<td class="table-cell">
					<input type='date' id='date'>
				</td>
			</tr>
			<tr class="border-bottom-light">
				<td width="36%" class="heading">Time Setting</td>
				<td width="7px" class="heading">:</td>
				<td class="table-cell"><select id="timezone-select"></select></td>
			</tr>
			<tr class="border-bottom-light">
				<td width="36%" class="heading">Daylight Saving</td>
				<td width="7px" class="heading">:</td>
				<td class="table-cell">
					<input type="checkbox" id="dst-select" name="dst-select">
				</td>
			</tr>
			<tr class="border-bottom-light">
				<td width="36%" class="heading"> </td>
				<td width="7px" class="heading">:</td>
				<td class="table-cell">
					<button id="updateTableButton"
						style="padding: 3px 5px; font-size:small; border-radius: 5px; color: white; text-decoration: none;"
						onclick="updateTimeHandle()">Update</button>
				</td>
			</tr>
		</table>
		<div class="table-container">
			<button style="font-size:small; background-color: #fff; border: 0;" id="gotoServiceBtn"
				onclick="gotoServicePages()">Goto Service local
				dash!</button>
		</div>
	</div>
	<!-- Profile  -->
	<div id="container2" class="container" style="flex-direction: column;">
		<div class="table-container">
			<table id="homeControlsTable" style="width:fit-content;">
				<tr style="text-align: start;">
					<td><button style="font-size:small;" id="ctrlButton3"
							onclick="controlButtonClick(3)">Register/Update</button></td>
				</tr>
			</table>
		</div>
		<table id="tableProfile" class="table-container">
			<tr>
				<th>Profile: Fetching information, click again if stale</th>
			</tr>
		</table>
	</div>
	<!-- WiFi  -->
	<div id="container3" class="container" style="flex-direction: column;">
		<table id="tableWiFi" class="table-container">
			<tr>
				<th>WiFi: Fetching information, click again if stale</th>
			</tr>
		</table>
		<table class="table-container">
			<tr>
				<td style="border: 0px;">
					<button id="scan-btn" onclick="wifi_scan_start_button()">Scan For Networks</button>
					<div class="loader" id="scanLoader" hidden="hidden"></div>
				</td>
			</tr>
		</table>
		<table id="scanTable" class="table-container-scan">
			<!-- Will be populated with scan report -->
		</table>
		<table id="passwordTable" class="table-container-scan">
			<!-- Will be populated after ssid selection -->
		</table>
	</div>
	<!-- Footer -->
	<div style="background-color: rgb(97, 106, 112); width: 100%; margin-top: 80px;">
		<p style="color: white; font-size: medium; text-align: center; padding: 10px;">@greyter.com All Rights Reserved
		</p>
	</div>

	<script>
		var xmlHttp = createXmlHttpObject();
		var response_came = false;
		var gotoServiceCount = 0;
		var update_process_enable = true;
		var current_containerNum = 1; // home
		var myTimeout = 0;
		get_data_names = ["HomeUser", "Profile", "WiFi"];
		exTypesArr = ["text", "number", "email", "password", "tel"];

		/* Fetch and Display Data */
		function get_data() {
			if (myTimeout) {
				clearTimeout(myTimeout);
			}
			_get_data_request(get_data_names[current_containerNum - 1]);
			myTimeout = setTimeout("get_data()", 3000);
		}
		function _get_data_request(name) {
			if (update_process_enable) {
				const data = `name=${name}`;
				if (xmlHttp.readyState == 0 || xmlHttp.readyState == 4) {
					xmlHttp.open("POST", `getData`, true);
					xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
					xmlHttp.onreadystatechange = function () {
						if (this.readyState == 4 && this.status == 200) {
							if (xmlHttp.responseXML) {
								// console.log("Data: ", xmlHttp);
								console.log("Data: rxd");
								populate_table(xmlHttp.responseXML.all, name, `table${name}`, "postData");
							}
						}
					}
					xmlHttp.send(data);
					console.log("Requesting", data);
				}
			}
			else {
				console.log("Data fetching disabled");
			}
		}
		function send_data(id, value, address) {
			const data = `id=${id}&value=${value}`;
			if (xmlHttp.readyState == 0 || xmlHttp.readyState == 4) {
				xmlHttp.open("POST", address, true);
				xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
				xmlHttp.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						console.log(this.responseText);
						update_process_enable = true;
						get_data();
					}
				}
				xmlHttp.send(data);
				console.log("Sending data: " + data);
			}
		}
		function checkInput(event) {
			let click_id = event.target.getAttribute("id");
			const input = document.getElementById(click_id);
			send_data(click_id, input.value, input.name);
		}
		function disableUpdates() {
			update_process_enable = false;
			console.log("disabled");
		}
		const indexEnum = {
			id: 0,
			valid: 1,
			delta: 2,
			r_w: 3,
			store: 4,
			maxLen: 5,
			len: 6,
			ex_typ: 7,
			data: 8,
			type: 9
		};
		function populate_table(x, title, tableName, post_address) {
			var txt = "";
			// console.log("Data: ", x, "length: ", x.length);
			console.log(title, tableName, post_address);
			txt += `<tr>`;
			txt += `<th style="font-size: large; color: white; text-align: start; background-color: rgb(43, 53, 60); padding: 7px;" colspan="3">${title}</th>`;
			txt += `</tr>`;
			for (i = 1; i < x.length; i++) {
				valueArr = [];
				name = x[i].nodeName.replace(/_/g, "  ");
				val = x[i].innerHTML;
				option_cell = "";
				if (val.indexOf(',') > -1) {
					valueArr = val.split(',');
					// console.log(valueArr);

					_isValid = valueArr[indexEnum.valid];
					_idV = valueArr[indexEnum.id];
					_erorr = valueArr[indexEnum.error];
					_namV = post_address;
					_valV = valueArr[indexEnum.data];
					_fncV = "checkInput(event);"
					_exTyp = "text";
					_readOnly = "";
					_minV = 0;
					_maxV = parseInt(valueArr[indexEnum.maxLen]);

					if (valueArr[indexEnum.r_w] === "0" || valueArr[indexEnum.r_w] === "3") {
						_readOnly = "readonly";
					}

					if (valueArr[indexEnum.ex_typ] < exTypesArr.length) {
						_exTyp = exTypesArr[valueArr[indexEnum.ex_typ]];
					}

					if (valueArr[indexEnum.type] === 'UINT8') {
						_minV = 0;
						_maxV = 255;
					}
					else if (valueArr[indexEnum.type] === 'INT8') {
						_minV = -128;
						_maxV = 127;
					}
					else if (valueArr[indexEnum.type] === 'UINT16') {
						_minV = 0;
						_maxV = 65535;
					}
					else if (valueArr[indexEnum.type] === 'INT16') {
						_minV = -32768;
						_maxV = 32767;
					}
					else if (valueArr[indexEnum.type] === 'UINT32') {
						_minV = 0;
						_maxV = 4294967295;
					}
					else if (valueArr[indexEnum.type] === 'INT32') {
						_minV = -2147483648;
						_maxV = 2147483647;
					}
					else {
						_minV = 0;
						_maxV = 0;
					}

					// console.log(_idV, _namV, _valV, _fncV, _exTyp, _minV, _maxV);
					// console.log("ID: " + _idV + " Name: " + _namV + " Value: " + _valV + " Error: " + _erorr + " ExType: " + _exTyp + " ReadOnly: " + _readOnly + " Min: " + _minV + " Max: " + _maxV);

					option_cell = `<td class="table-cell">`;
					if (_erorr == "1") {
						option_cell += `<span class="label danger">Error</span>`;
					}

					if (_readOnly === "readonly") {
						if (_isValid == "1") {
							option_cell += `<input style="background-color: LightGray" type=${_exTyp} id=${_idV} name=${_namV} ${_readOnly} min=${_minV} max=${_maxV} value="${_valV}">`;
						}
						else {
							option_cell += `<input style="background-color: LightGray" type=${_exTyp} id=${_idV} name=${_namV} ${_readOnly} min=${_minV} max=${_maxV}>`;
						}
					}
					else {
						if (valueArr[indexEnum.type] === 'ENUM_MANUAL'
							|| valueArr[indexEnum.type] === 'TRUE_FALSE'
							|| valueArr[indexEnum.type] === 'OFF_ON'
							|| valueArr[indexEnum.type] === 'YES_NO') {
							option_cell += `<span class="label other">${_valV}</span>`;
							option_cell += `<select id=${_idV} name=${_namV} onClick="disableUpdates()" onchange=${_fncV}>`;
							let value_enum = 0;
							for (let index = (indexEnum.type + 1); index < valueArr.length; index++) {
								const element = valueArr[index];
								if (element === _valV) {
									option_cell += `<option value=${value_enum} selected>${element}</option>`;
								}
								else {
									option_cell += `<option value=${value_enum}>${element}</option>`;
								}
								value_enum = value_enum + 1;
							}
							option_cell += `</select>`;
						}
						else {
							if (_isValid == "1") {
								option_cell += `<input type=${_exTyp} id=${_idV} name=${_namV} onClick="disableUpdates()" onchange=${_fncV} min=${_minV} max=${_maxV} value="${_valV}">`;
							}
							else {
								option_cell += `<input type=${_exTyp} id=${_idV} name=${_namV} onClick="disableUpdates()" onchange=${_fncV} min=${_minV} max=${_maxV}>`;
							}
						}
					}
					option_cell += `</td>`;
					// console.log("Cell: " + option_cell);
					// console.log("------------------------------------------------");
				}
				txt += `<tr class="border-bottom-light">`;
				txt += `<td class="heading">${name}</td>`;
				txt += `<td width="7px" class="heading">:</td>`;
				txt += option_cell;
				txt += `</tr>`;
			}
			if (txt) {
				document.getElementById(`${tableName}`).innerHTML = txt;
			}
			// console.log("------------------------------------------------\n\n");
		}

		/* Generic Functions */
		function showContainer(containerNum) {
			// hide all containers
			var containers = document.getElementsByClassName("container");
			for (var i = 0; i < containers.length; i++) {
				containers[i].classList.remove("active");
			}

			// show the selected container
			var container = document.getElementById("container" + containerNum);
			container.classList.add("active");

			// set active link in navbar
			var links = document.getElementsByTagName("a");
			for (var i = 0; i < links.length; i++) {
				links[i].classList.remove("active-link");
			}
			var link = document.getElementsByTagName("a")[containerNum - 1];
			link.classList.add("active-link");

			current_containerNum = containerNum;
			if (!update_process_enable) update_process_enable = true;
			get_data();
		}
		function createXmlHttpObject() {
			if (window.XMLHttpRequest) {
				xmlHttp = new XMLHttpRequest();
			}
			else {
				xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			return xmlHttp;
		}

		/* Control */
		function gotoServicePages() {
			gotoServiceCount++;
			if (gotoServiceCount > 5) {
				gotoServiceCount = 0;
				window.open('/service', '_blank');
			}
			console.log("gotoServiceCount: " + gotoServiceCount);
		}


		function enableControlButton() {
			let controlButton = document.getElementById("ctrlButton3");
			controlButton.disabled = false;
		}

		function controlButtonClick(id) {
			const data = `controls=${1}&id=${id}`;
			let controlButton = document.getElementById("ctrlButton3");
			controlButton.disabled = true;
			if (xmlHttp.readyState == 0 || xmlHttp.readyState == 4) {
				xmlHttp.open("POST", "postControls", true);
				xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

				xmlHttp.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						console.log(this.responseText);
						setTimeout("enableControlButton()", 5000);
					}
				}
				xmlHttp.send(data);
			}
		}

		/* WiFi */
		var ssidArray = [];
		function wifi_scan_start_button() {
			if (xmlHttp.readyState == 0 || xmlHttp.readyState == 4) {
				document.getElementById("scanLoader").removeAttribute("hidden");
				document.getElementById("scan-btn").disabled = true;
				document.getElementById("scan-btn").innerHTML = "Wait! Scanning...  ";
				update_process_enable = false;
				xmlHttp.open("GET", "getUserWiFiScan", true);
				xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
				xmlHttp.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						document.getElementById("scanLoader").setAttribute("hidden", "hidden");
						document.getElementById("scan-btn").disabled = false;
						document.getElementById("scan-btn").innerHTML = "Scan For Networks";
						wifi_scan_data_parser(this.responseText);
					}
				}
				xmlHttp.send();
			}
		}
		function wifi_scan_data_parser(scanData) {
			console.log("Scan Data:", scanData);
			scanData = scanData.replace(/[^\w\s<>\/]/g, ' ');
			console.log("New Scan Data", scanData);
			var parser = new DOMParser();
			var xmlDocScan = parser.parseFromString(scanData, "text/xml");
			console.log("Scan Document:", xmlDocScan);

			ssid = xmlDocScan.getElementsByTagName("ssid");
			console.log("ssid Data:", ssid);

			txt = "<tr>";
			txt += `<th class="heading">SSID</th>`;
			txt += "</tr>";
			for (i = 0; i < ssid.length; i++) {
				ssidArray[i] = ssid[i].childNodes[0].nodeValue;
				txt += "<tr>";
				txt += `<td class="table-cell-select" data-id=${i} onClick="wifi_ssid_selected()">${ssid[i].childNodes[0].nodeValue}</td>`;
				txt += "</tr>";
			}
			document.getElementById("scanTable").innerHTML = txt;
		}
		function wifi_ssid_selected() {
			connectID = event.target.getAttribute("data-id");
			console.log("Clicked On : ", ssidArray[connectID]);
			txt1 = "<tr>";
			txt1 += `<th class="heading">SSID</th>`;
			txt1 += `<th class="heading">Password</th>`;
			txt1 += `<th class="heading">Action</th>`;
			txt1 += "</tr>";
			txt1 += "<tr>";
			txt1 += `<td class="table-cell">${ssidArray[connectID]}</td>`;
			txt1 += `<td class="table-cell"><input type="password" id="setPass"></td>`;
			txt1 += `<td class="table-cell" onClick="wifi_ssid_password_entered()"><button type="button">Save</button></td>`;
			txt1 += "</tr>";
			document.getElementById("passwordTable").innerHTML = txt1;
		}
		function wifi_ssid_password_entered() {
			pass = document.getElementById('setPass').value;
			console.log("SSID: ", ssidArray[connectID], "Pass: " + pass);
			wifi_ssid_connect_request(connectID, ssidArray[connectID], pass);
		}
		function wifi_ssid_connect_request(id, name, password) {
			const data = `ssid_id=${id}&name=${name}&password=${password}`;
			if (xmlHttp.readyState == 0 || xmlHttp.readyState == 4) {
				xmlHttp.open("POST", "postUserWiFiConnect", true);
				xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
				xmlHttp.send(data);
				console.log("Connect request sent", data);
				txt2 = "<tr>";
				txt2 += `<td class="table-cell">New SSID and Password sent, wait few seconds!</td>`;
				txt2 += "</tr>";
				document.getElementById("scanTable").innerHTML = txt2;
				document.getElementById("passwordTable").innerHTML = "";
				setTimeout("clearWiFiScantables()", 6000);
				update_process_enable = true;
			}
		}
		function clearWiFiScantables() {
			document.getElementById("scanTable").innerHTML = "";
		}

		/* Time */
		var apmArray = ["AM", "PM"];
		// Time Settings
		const utcCityData = [["-43200", "Baker Island", "Howland Island"],
		["-39600", "Pago Pago", "Niue"],
		["-36000", "Honolulu", "Hilo", "Rarotonga"],
		["-34200", "Marquesas Islands"],
		["-32400", "Anchorage", "Juneau", "Gambier Islands"],
		["-28800", "Los Angeles", "Vancouver", "Tijuana"],
		["-25200", "Denver", "Edmonton", "Phoenix"],
		["-21600", "Chicago", "Mexico City", "Guatemala City"],
		["-18000", "New York", "Toronto", "Havana"],
		["-16200", "Caracas"],
		["-14400", "Halifax", "Santiago", "Santo Domingo"],
		["-12600", "St. John's"],
		["-10800", "Buenos Aires", "Brasilia", "Montevideo"],
		["-7200", "South Georgia and the South Sandwich Islands", "Fernando de Noronha"],
		["-3600", "Cape Verde", "Azores"],
		["0", "London", "Dublin", "Lisbon"],
		["3600", "Berlin", "Paris", "Madrid"],
		["7200", "Athens", "Cairo", "Jerusalem"],
		["10800", "Moscow", "Riyadh", "Nairobi"],
		["12600", "Tehran"],
		["14400", "Dubai", "Abu Dhabi", "Samara"],
		["16200", "Kabul"],
		["18000", "Islamabad", "Karachi", "Tashkent"],
		["19800", "Mumbai", "Kolkata", "Chennai", "New Delhi"],
		["20700", "Kathmandu"],
		["21600", "Almaty", "Dhaka", "Novosibirsk"],
		["23400", "Yangon", "Cocos Islands"],
		["25200", "Bangkok", "Ho Chi Minh City", "Jakarta"],
		["28800", "Beijing", "Hong Kong", "Singapore"],
		["31500", "Eucla"],
		["32400", "Tokyo", "Seoul", "Yakutsk"],
		["34200", "Adelaide", "Darwin"],
		["36000", "Sydney", "Melbourne", "Brisbane"],
		["37800", "Lord Howe Island"],
		["39600", "Vladivostok", "Noumea", "Solomon Islands"],
		["43200", "Auckland", "Wellington", "Fiji"],
		["45900", "Chatham"],
		["46800", "Apia", "Tongatapu"],
		["50400", "Kiritimati"]
		];

		const timezoneSelect = document.getElementById("timezone-select");
		const timeHours = document.getElementById("time-hours");
		const timeMinutes = document.getElementById("time-minutes");
		const timeApm = document.getElementById("time-apm");
		const dstSelect = document.getElementById("dst-select");
		const dateSelected = document.getElementById("date");

		for (let i = 0; i < utcCityData.length; i++) {
			const option = document.createElement("option");
			option.value = utcCityData[i][0];
			option.text = utcCityData[i].slice(1).join(", ");
			timezoneSelect.appendChild(option);
		}
		let j = 0;
		for (let i = 0; i < 12; i++) {
			const option = document.createElement("option");
			option.value = i;
			j = i;
			if (j === 0) j = 12;
			option.text = j.toLocaleString('en-US', { minimumIntegerDigits: 2 });
			timeHours.appendChild(option);
		}
		for (let i = 0; i < 60; i++) {
			const option = document.createElement("option");
			option.value = i;
			option.text = i.toLocaleString('en-US', { minimumIntegerDigits: 2 });
			timeMinutes.appendChild(option);
		}
		for (let i = 0; i < apmArray.length; i++) {
			const option = document.createElement("option");
			option.value = i;
			option.text = apmArray[i];
			timeApm.appendChild(option);
		}
		function editTimeHandle() {
			document.getElementById("editTableButton").disabled = true;
			document.getElementById("editTableButton").hidden = true;
			document.getElementById("userEditTimeTable").style.display = "flex";
		}
		function updateTimeHandle() {
			document.getElementById("editTableButton").disabled = false;
			document.getElementById("editTableButton").hidden = false;
			document.getElementById("userEditTimeTable").style.display = "none";
			var hoursWithAPM = parseInt(timeHours.value);
			if (parseInt(timeApm.value)) {
				// PM
				hoursWithAPM = hoursWithAPM + 12;
				console.log("Updated hours: ", hoursWithAPM);
			}
			const selectedDate = new Date(dateSelected.value);
			console.log(selectedDate);
			var addingSeconds = hoursWithAPM * 60 + parseInt(timeMinutes.value); // minutes
			addingSeconds = addingSeconds * 60 * 1000; // seconds 
			var utcSeconds = selectedDate.getTime() + addingSeconds;
			utcSeconds = utcSeconds - (parseInt(timezoneSelect.value) * 1000); // add if negative, subtract if positive
			utcSeconds = utcSeconds - (dstSelect.checked ? (3600 * 1000) : 0);
			utcSeconds = utcSeconds / 1000;
			console.log(utcSeconds);
			var tmZoneSeconds = parseInt(timezoneSelect.value) + (dstSelect.checked ? 3600 : 0);
			const data = `tmUtcSeconds=${utcSeconds}&tmZoneSec=${tmZoneSeconds}`;
			if (xmlHttp.readyState == 0 || xmlHttp.readyState == 4) {
				xmlHttp.open("POST", "postUserTime", true);
				xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
				xmlHttp.onreadystatechange = function () {
					if (this.readyState == 4 && this.status == 200) {
						console.log(this.responseText);
					}
				}
				xmlHttp.send(data);
			}
			console.log("Time update request sent", data);
		}
	</script>
</body>

</html>